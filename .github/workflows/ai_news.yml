name: AI News Translator & Push

on:
  schedule:
    - cron: '0 1 * * *' # æ¯å¤©åŒ—äº¬æ—¶é—´æ—©ä¸Š 9:00 è¿è¡Œ
  workflow_dispatch: # æ”¯æŒä½ æ‰‹åŠ¨ç‚¹å‡»è¿è¡Œæµ‹è¯•

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: pip install feedparser requests

      - name: Run News Bot
        env:
          AI_API_KEY: ${{ secrets.AI_API_KEY }}
          WECHAT_WEBHOOK: ${{ secrets.WECHAT_WEBHOOK }}
        run: |
          python - <<EOF
          import feedparser
          import requests
          import os

          # 1. æŠ“å–è‹±æ–‡ AI èµ„è®¯ (The Verge AI)
          feed = feedparser.parse("https://www.theverge.com/ai-artificial-intelligence/rss/index.xml")
          top_news = feed.entries[:3]  # æ¯æ¬¡å–æœ€æ–°çš„ 3 æ¡ï¼Œé˜²æ­¢å­—æ•°å¤ªå¤š

          # 2. å‡†å¤‡ç¿»è¯‘å’Œæ¨é€çš„å†…å®¹
          final_message = "ğŸ¤– **AI è¡Œä¸šæœ€æ–°èµ„è®¯ (è‡ªåŠ¨ç¿»è¯‘)**\n\n"

          for entry in top_news:
              title_en = entry.title
              link = entry.link
              
              # è°ƒç”¨ DeepSeek è¿›è¡Œç¿»è¯‘ (è¿™é‡Œä½¿ç”¨ OpenAI å…¼å®¹æ ¼å¼)
              try:
                  resp = requests.post(
                      "https://api.deepseek.com/chat/completions",
                      headers={"Authorization": f"Bearer {os.environ['AI_API_KEY']}"},
                      json={
                          "model": "deepseek-chat",
                          "messages": [
                              {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç§‘æŠ€ç¿»è¯‘åŠ©æ‰‹ï¼Œè¯·å°†ä¸‹æ–¹çš„ AI æ–°é—»æ ‡é¢˜ç¿»è¯‘æˆé€šä¿—æ˜“æ‡‚çš„ä¸­æ–‡ï¼Œåªè¿”å›ç¿»è¯‘ç»“æœã€‚"},
                              {"role": "user", "content": title_en}
                          ]
                      }
                  )
                  title_cn = resp.json()['choices'][0]['message']['content']
              except:
                  title_cn = "ï¼ˆç¿»è¯‘å¤±è´¥ï¼‰" + title_en

              final_message += f"ğŸ”¹ **{title_cn}**\nğŸ”— [åŸæ–‡é“¾æ¥]({link})\n\n"

          # 3. æ¨é€åˆ°ä¼ä¸šå¾®ä¿¡æœºå™¨äºº
          requests.post(
              os.environ['WECHAT_WEBHOOK'],
              json={
                  "msgtype": "markdown",
                  "markdown": {"content": final_message}
              }
          )
          print("æ¨é€å®Œæˆï¼")
          EOF
